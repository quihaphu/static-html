<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQMS Setup Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            margin: -20px -20px 40px -20px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--border-color);
            z-index: -1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            background-color: var(--bg-secondary);
            padding: 0 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step:hover .step-number {
            transform: scale(1.1);
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--border-color);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background-color: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            max-width: 100px;
        }

        .card {
            background-color: var(--bg-primary);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .radio-group, .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover, .checkbox-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }

        .radio-option input[type="radio"],
        .checkbox-option input[type="checkbox"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .radio-option.selected,
        .checkbox-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.1);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .input-row label {
            flex: 1;
            font-weight: 500;
        }

        .input-row input {
            width: 100px;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-row input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: space-between;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            transition: width 0.5s ease;
            width: 0%;
        }

        .pattern-match {
            background-color: rgba(37, 99, 235, 0.05);
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .pattern-match h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .quality-objective {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .quality-objective:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        .objective-number {
            width: 30px;
            height: 30px;
            background-color: var(--success-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 15px;
        }

        .risk-card {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .risk-card.high {
            border-color: var(--danger-color);
            background-color: rgba(239, 68, 68, 0.05);
        }

        .risk-card.medium {
            border-color: var(--warning-color);
            background-color: rgba(245, 158, 11, 0.05);
        }

        .risk-card.low {
            border-color: var(--success-color);
            background-color: rgba(16, 185, 129, 0.05);
        }

        .risk-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .risk-title {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .risk-level {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            color: white;
        }

        .risk-level.high {
            background-color: var(--danger-color);
        }

        .risk-level.medium {
            background-color: var(--warning-color);
        }

        .risk-level.low {
            background-color: var(--success-color);
        }

        .risk-details {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .risk-actions {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .response-card {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .response-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow);
        }

        .response-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .response-icon {
            font-size: 1.5rem;
        }

        .response-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .response-details {
            background-color: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .response-meta {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .response-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkbox-large {
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }

        .loading-screen {
            text-align: center;
            padding: 60px 0;
        }

        .loading-icon {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .loading-steps {
            text-align: left;
            max-width: 400px;
            margin: 0 auto;
        }

        .loading-step {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }

        .loading-step.active {
            opacity: 1;
        }

        .loading-step-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .loading-step.active .loading-step-icon {
            background-color: var(--success-color);
            color: white;
        }

        .review-summary {
            background-color: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success-color);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
        }

        .review-summary h2 {
            color: var(--success-color);
            margin-bottom: 20px;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .compliance-badge {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--success-color);
            color: white;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 20px;
        }

        .final-package {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.05), rgba(59, 130, 246, 0.05));
            border-radius: 12px;
            border: 2px solid var(--primary-color);
        }

        .package-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .package-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .document-list {
            text-align: left;
            max-width: 600px;
            margin: 0 auto 30px;
        }

        .document-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .document-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-lg);
        }

        .document-icon {
            font-size: 1.5rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .step-label {
                font-size: 0.75rem;
                max-width: 80px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .input-row {
                flex-direction: column;
                align-items: stretch;
            }

            .input-row input {
                width: 100%;
            }

            .summary-stats {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>SQMS Setup Assistant</h1>
        <p>Set up your quality management system in minutes using proven patterns</p>
    </div>

    <div class="container">
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Welcome</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Core Questions</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Pattern Match</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Quality Plan</div>
            </div>
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">Risk Review</div>
            </div>
            <div class="step" data-step="6">
                <div class="step-number">6</div>
                <div class="step-label">Responses</div>
            </div>
            <div class="step" data-step="7">
                <div class="step-number">7</div>
                <div class="step-label">Professional Review</div>
            </div>
            <div class="step" data-step="8">
                <div class="step-number">8</div>
                <div class="step-label">Final Package</div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <!-- Screen 1: Welcome -->
        <div class="screen active" id="screen1">
            <div class="card">
                <div style="text-align: center; padding: 40px 0;">
                    <h2 style="font-size: 2.5rem; margin-bottom: 20px;">Welcome to SQMS Setup Assistant</h2>
                    <p style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 40px;">
                        Let's set up your quality management system using proven industry patterns!
                    </p>
                    <div style="background-color: rgba(37, 99, 235, 0.05); padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px;">SQMS 2025</h3>
                        <p style="color: var(--text-secondary);">
                            We use proven patterns from hundreds of CPA firms to instantly match your firm profile 
                            with the right quality management requirements.
                        </p>
                    </div>
                    <button class="btn btn-primary" onclick="nextScreen()">
                        Start Setup
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 2: Core Questions -->
        <div class="screen" id="screen2">
            <!-- Question 1 -->
            <div class="card question-card" data-question="1" style="display: block;">
                <h3 class="question-title">What type of firm are you?</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="firmType" value="sole">
                        <span>Sole practitioner (just you)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="firmType" value="partnership">
                        <span>Partnership (multiple partners)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="firmType" value="corporation">
                        <span>Corporation</span>
                    </label>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousScreen()">
                        <span>‚Üê</span>
                        Back
                    </button>
                    <button class="btn btn-primary" onclick="nextQuestion()" disabled>
                        Next Question
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="card question-card" data-question="2" style="display: none;">
                <h3 class="question-title">How many people work at your firm?</h3>
                <div class="input-group">
                    <div class="input-row">
                        <label>Partners:</label>
                        <input type="number" id="partners" min="1" value="3">
                    </div>
                    <div class="input-row">
                        <label>Staff:</label>
                        <input type="number" id="staff" min="0" value="8">
                    </div>
                    <div class="input-row">
                        <label>Offices:</label>
                        <input type="number" id="offices" min="1" value="2">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousQuestion()">
                        <span>‚Üê</span>
                        Previous
                    </button>
                    <button class="btn btn-primary" onclick="nextQuestion()">
                        Next Question
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="card question-card" data-question="3" style="display: none;">
                <h3 class="question-title">What services do you provide?</h3>
                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="services" value="audit">
                        <span>Audit engagements</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="services" value="review">
                        <span>Review engagements</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="services" value="compilation">
                        <span>Compilation engagements</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="services" value="tax">
                        <span>Tax services</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="services" value="consulting">
                        <span>Consulting services</span>
                    </label>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousQuestion()">
                        <span>‚Üê</span>
                        Previous
                    </button>
                    <button class="btn btn-primary" onclick="nextQuestion()" disabled>
                        Next Question
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="card question-card" data-question="4" style="display: none;">
                <h3 class="question-title">What types of clients do you serve?</h3>
                <div class="checkbox-group">
                    <label class="checkbox-option">
                        <input type="checkbox" name="clientTypes" value="private">
                        <span>Private companies</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="clientTypes" value="public">
                        <span>Public companies (SEC registrants)</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="clientTypes" value="nonprofit">
                        <span>Non-profit organizations</span>
                    </label>
                    <label class="checkbox-option">
                        <input type="checkbox" name="clientTypes" value="government">
                        <span>Government entities</span>
                    </label>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousQuestion()">
                        <span>‚Üê</span>
                        Previous
                    </button>
                    <button class="btn btn-primary" onclick="nextQuestion()" disabled>
                        Next Question
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="card question-card" data-question="5" style="display: none;">
                <h3 class="question-title">What technology setup do you use?</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="technology" value="basic">
                        <span>Basic (spreadsheets, basic software)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="technology" value="professional">
                        <span>Professional (Caseware, ProSystem, etc.)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="technology" value="cloud">
                        <span>Cloud-based (fully integrated cloud systems)</span>
                    </label>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousQuestion()">
                        <span>‚Üê</span>
                        Previous
                    </button>
                    <button class="btn btn-primary" onclick="nextQuestion()" disabled>
                        Next Question
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>

            <!-- Question 6 -->
            <div class="card question-card" data-question="6" style="display: none;">
                <h3 class="question-title">Do you use external service providers?</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="externalProviders" value="none">
                        <span>No external providers</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="externalProviders" value="it-only">
                        <span>IT support only</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="externalProviders" value="it-vendor">
                        <span>IT vendor (comprehensive support)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="externalProviders" value="multiple">
                        <span>Multiple external providers</span>
                    </label>
                </div>
                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousQuestion()">
                        <span>‚Üê</span>
                        Previous
                    </button>
                    <button class="btn btn-primary" onclick="completeQuestions()">
                        Complete Questions
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 3: Pattern Matching -->
        <div class="screen" id="screen3">
            <div class="card">
                <div class="loading-screen">
                    <div class="loading-icon"></div>
                    <h3 class="loading-text">üîç System is matching your profile</h3>
                    <div class="loading-steps">
                        <div class="loading-step" id="step1">
                            <div class="loading-step-icon">‚Ä¢</div>
                            <span>Identifying firm type pattern</span>
                        </div>
                        <div class="loading-step" id="step2">
                            <div class="loading-step-icon">‚Ä¢</div>
                            <span>Mapping to quality requirements</span>
                        </div>
                        <div class="loading-step" id="step3">
                            <div class="loading-step-icon">‚Ä¢</div>
                            <span>Selecting relevant risks</span>
                        </div>
                        <div class="loading-step" id="step4">
                            <div class="loading-step-icon">‚Ä¢</div>
                            <span>Preparing standard responses</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Screen 4: Quality Management Plan -->
        <div class="screen" id="screen4">
            <div class="card">
                <div class="pattern-match">
                    <h3 id="patternTitle">Pattern Match: Medium Partnership</h3>
                    <p>Based on your profile, we've identified the quality management requirements for your firm</p>
                </div>

                <h2 style="margin-bottom: 20px;">üìã Your Quality Management Plan</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    All 7 AICPA-required quality objectives are included:
                </p>

                <div id="objectivesList">
                    <!-- Will be populated by JavaScript -->
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousScreen()">
                        <span>‚Üê</span>
                        Back
                    </button>
                    <button class="btn btn-primary" onclick="nextScreen()">
                        View Identified Risks
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 5: Risk Review -->
        <div class="screen" id="screen5">
            <div class="card">
                <h2 style="margin-bottom: 30px;">‚ö†Ô∏è Quality Risks Identified</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">
                    Based on your firm profile, we've identified the following quality risks:
                </p>

                <div id="risksList">
                    <!-- Will be populated by JavaScript -->
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousScreen()">
                        <span>‚Üê</span>
                        Back
                    </button>
                    <button class="btn btn-primary" onclick="nextScreen()">
                        Review Responses
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 6: Response Review -->
        <div class="screen" id="screen6">
            <div class="card">
                <h2 style="margin-bottom: 30px;">üìã Recommended Responses</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">
                    Review and select the procedures to address your identified risks:
                </p>

                <div id="responsesList">
                    <!-- Will be populated by JavaScript -->
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="previousScreen()">
                        <span>‚Üê</span>
                        Back
                    </button>
                    <button class="btn btn-primary" onclick="nextScreen()">
                        Submit for Review
                        <span>‚Üí</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Screen 7: Professional Review -->
        <div class="screen" id="screen7">
            <div class="card">
                <div style="text-align: center; padding: 40px 0;">
                    <h2 style="margin-bottom: 30px;">üë®‚Äçüíº Professional Review Required</h2>
                    <div class="loading-icon"></div>
                    <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 30px;">
                        A qualified professional will:
                    </p>
                    <ul style="text-align: left; max-width: 400px; margin: 0 auto; list-style: none;">
                        <li style="margin-bottom: 15px;">‚Ä¢ Review your selected risks</li>
                        <li style="margin-bottom: 15px;">‚Ä¢ Validate response selections</li>
                        <li style="margin-bottom: 15px;">‚Ä¢ Ensure AICPA compliance</li>
                        <li style="margin-bottom: 15px;">‚Ä¢ Make final adjustments</li>
                        <li style="margin-bottom: 15px;">‚Ä¢ Approve the final plan</li>
                    </ul>
                    <p style="margin-top: 30px; color: var(--primary-color); font-weight: 600;">
                        Review in Progress...
                    </p>
                </div>
            </div>
        </div>

        <!-- Screen 8: Final Package -->
        <div class="screen" id="screen8">
            <div class="card">
                <div class="review-summary">
                    <h2>‚úÖ Professional Review Complete</h2>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <div class="stat-number">7</div>
                            <div class="stat-label">Quality Objectives</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="riskCount">5</div>
                            <div class="stat-label">Quality Risks</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="responseCount">5</div>
                            <div class="stat-label">Response Procedures</div>
                        </div>
                    </div>
                    <p style="margin-top: 20px;">
                        <strong>Modifications Made:</strong><br>
                        ‚Ä¢ Added quarterly vendor reviews<br>
                        ‚Ä¢ Increased monitoring frequency<br>
                        ‚Ä¢ Enhanced geographic coordination
                    </p>
                    <div class="compliance-badge">
                        96% AICPA Compliance Score
                    </div>
                </div>

                <div class="final-package" style="margin-top: 30px;">
                    <div class="package-icon">üì¶</div>
                    <h2 class="package-title"><span id="firmNameDisplay">Smith & Associates</span> SQMS Package</h2>
                    
                    <div class="document-list">
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>Quality Management Manual (15 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>Partner Supervision Procedures (8 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>Technology Management Procedures (5 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>Quality Monitoring System (12 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>Geographic Coordination Plan (6 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>External Vendor Oversight (4 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>Staff Training Program (10 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìã</span>
                            <span>Implementation Timeline (2 pages)</span>
                        </div>
                        <div class="document-item">
                            <span class="document-icon">üìä</span>
                            <span>Compliance Report (96% Score)</span>
                        </div>
                    </div>

                    <div class="btn-group" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="downloadDocuments()">
                            üì• Download All
                        </button>
                        <button class="btn btn-primary" onclick="viewImplementationGuide()">
                            üìñ Implementation Guide
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentScreen = 1;
        let currentQuestion = 1;
        let totalQuestions = 6; // Updated question count
        let selectedRisks = [];
        let selectedResponses = [];
        let formData = {
            firmName: 'Smith & Associates',
            firmType: '',
            partners: 3,
            staff: 8,
            offices: 2,
            services: [],
            clientTypes: [],
            technology: '',
            externalProviders: '',
            qualityManagement: 'basic',
            monitoring: 'informal',
            standards: ['aicpa']
        };

        // AICPA Quality Objectives (Standard for all firms)
        const qualityObjectives = [
            {
                id: 'LG',
                title: 'Leadership and Governance',
                description: 'The firm demonstrates a commitment to quality through a culture that exists throughout the firm'
            },
            {
                id: 'RER',
                title: 'Relevant Ethical Requirements', 
                description: 'The firm and its personnel comply with relevant ethical requirements, including independence'
            },
            {
                id: 'AC',
                title: 'Acceptance and Continuance',
                description: 'The firm accepts or continues client relationships and engagements only when appropriate'
            },
            {
                id: 'EP',
                title: 'Engagement Performance',
                description: 'Engagements are performed consistently and engagement reports are appropriate'
            },
            {
                id: 'RS',
                title: 'Resources',
                description: 'The firm has appropriate resources to enable consistent performance of quality engagements'
            },
            {
                id: 'IC',
                title: 'Information and Communication',
                description: 'The firm obtains, generates, or uses relevant, reliable, and timely information'
            },
            {
                id: 'MR',
                title: 'Monitoring and Remediation',
                description: 'The firm monitors its system of quality management through ongoing evaluation'
            }
        ];

        // Predefined Risk Patterns
        const riskPatterns = {
            'Small Firm': [
                {
                    id: 'LG-001',
                    objective: 'LG',
                    title: 'Lack of formal leadership structure',
                    description: 'Single practitioner may lack formal quality management oversight',
                    level: 'medium',
                    aicpaReference: 'SQMS 3.10',
                    reasons: ['Single practitioner structure', 'Limited oversight capacity', 'Need for self-monitoring procedures']
                },
                {
                    id: 'RS-001',
                    objective: 'RS', 
                    title: 'Limited human resources',
                    description: 'Small staff may lack specialized skills or adequate supervision',
                    level: 'high',
                    aicpaReference: 'SQMS 5.60',
                    reasons: ['Small staff size', 'Limited specialization', 'Supervision challenges']
                }
            ],
            'Medium Partnership': [
                {
                    id: 'LG-002',
                    objective: 'LG',
                    title: 'Partner coordination and responsibility',
                    description: 'Multiple partners require clear quality management roles and coordination',
                    level: 'high',
                    aicpaReference: 'SQMS 3.10',
                    reasons: ['You have multiple partners', 'Need clear quality management roles', 'Coordination required across partners']
                },
                {
                    id: 'EP-001',
                    objective: 'EP',
                    title: 'Supervision across multiple partners',
                    description: 'Ensuring consistent supervision and review across different partners',
                    level: 'high', 
                    aicpaReference: 'SQMS 5.40',
                    reasons: ['Multiple partners managing engagements', 'Need consistent supervision standards', 'Quality coordination required']
                },
                {
                    id: 'RS-002',
                    objective: 'RS',
                    title: 'Technology dependencies',
                    description: 'Reliance on external IT vendors and professional software systems',
                    level: 'medium',
                    aicpaReference: 'SQMS 5.60',
                    reasons: ['External IT vendor dependency', 'Professional software reliance', 'Need backup procedures']
                },
                {
                    id: 'IC-001',
                    objective: 'IC',
                    title: 'Geographic coordination',
                    description: 'Communication and coordination across multiple office locations',
                    level: 'medium',
                    aicpaReference: 'SQMS 5.70',
                    reasons: ['Multiple office locations', 'Need consistent procedures', 'Communication between offices']
                },
                {
                    id: 'MR-002',
                    objective: 'MR',
                    title: 'Informal monitoring procedures',
                    description: 'Current informal monitoring needs formalization for compliance',
                    level: 'high',
                    aicpaReference: 'SQMS 6.20',
                    reasons: ['Currently informal monitoring', 'AICPA requires formal procedures', 'Quality assurance needed']
                }
            ],
            'Large Firm': [
                {
                    id: 'LG-003',
                    objective: 'LG',
                    title: 'Complex supervision hierarchy',
                    description: 'Large firms require sophisticated quality management structure',
                    level: 'high',
                    aicpaReference: 'SQMS 3.10',
                    reasons: ['Large firm complexity', 'Multiple management layers', 'Sophisticated oversight needed']
                }
            ]
        };

        // Predefined Response Mappings
        const responseMappings = {
            'LG-002': {
                id: 'RESP-LG-002',
                title: 'Leadership Structure and Roles',
                icon: 'üë®‚Äçüíº',
                description: 'Establish clear leadership structure and quality management roles',
                procedures: [
                    'Designate firm quality leader',
                    'Define partner quality responsibilities',
                    'Create governance structure',
                    'Establish quality culture initiatives',
                    'Document leadership roles and responsibilities'
                ],
                templates: ['Leadership Role Matrix', 'Quality Culture Assessment'],
                training: '3 hours',
                implementation: '3 weeks'
            },
            'EP-001': {
                id: 'RESP-EP-001',
                title: 'Partner Supervision Procedures',
                icon: 'üìã',
                description: 'Establish clear supervision procedures for multi-partner firms',
                procedures: [
                    'Designate engagement partner for each client',
                    'Define review responsibilities by partner', 
                    'Create supervision checklist',
                    'Weekly partner coordination meetings',
                    'Document supervision activities'
                ],
                templates: ['Supervision Checklist', 'Partner Review Documentation'],
                training: '2 hours',
                implementation: '2 weeks'
            },
            'RS-002': {
                id: 'RESP-RS-002',
                title: 'Technology Management Procedures',
                icon: 'üíª',
                description: 'Establish procedures for managing technology dependencies',
                procedures: [
                    'Document all software systems',
                    'Create vendor contact list',
                    'Establish backup procedures',
                    'Test recovery procedures quarterly',
                    'Identify alternative software options'
                ],
                templates: ['Software Inventory Template', 'Backup Procedures Checklist'],
                training: '1 hour',
                implementation: '1 week'
            },
            'IC-001': {
                id: 'RESP-IC-001',
                title: 'Geographic Coordination Plan',
                icon: 'üè¢',
                description: 'Coordinate quality management across multiple offices',
                procedures: [
                    'Regular inter-office meetings',
                    'Shared procedures documentation',
                    'Communication protocols',
                    'Quality consistency checks',
                    'Cross-office quality reviews'
                ],
                templates: ['Office Coordination Template', 'Communication Protocol'],
                training: '2 hours',
                implementation: '2 weeks'
            },
            'MR-002': {
                id: 'RESP-MR-002',
                title: 'Quality Monitoring System',
                icon: 'üìä',
                description: 'Implement formal quality monitoring and review procedures',
                procedures: [
                    'Monthly quality reviews',
                    'Engagement quality checklist',
                    'Partner peer reviews',
                    'Annual internal inspection',
                    'Quality improvement tracking'
                ],
                templates: ['Quality Monitoring Checklist', 'Peer Review Template'],
                training: '3 hours',
                implementation: '3 weeks'
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to step indicators
            document.querySelectorAll('.step').forEach(step => {
                step.addEventListener('click', function() {
                    const stepNum = parseInt(this.dataset.step);
                    if (stepNum < currentScreen || this.classList.contains('completed')) {
                        goToScreen(stepNum);
                    }
                });
            });

            // Add change handlers for radio buttons
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    // Update visual state
                    const radioGroup = document.querySelectorAll(`input[name="${this.name}"]`);
                    radioGroup.forEach(r => {
                        r.parentElement.classList.remove('selected');
                    });
                    this.parentElement.classList.add('selected');
                    
                    // Enable next button
                    const card = this.closest('.question-card');
                    const nextBtn = card.querySelector('.btn-primary');
                    if (nextBtn) nextBtn.disabled = false;
                    
                    // Store data
                    formData[this.name] = this.value;
                });
            });

            // Add change handlers for checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    // Update visual state
                    if (this.checked) {
                        this.parentElement.classList.add('selected');
                    } else {
                        this.parentElement.classList.remove('selected');
                    }
                    
                    // Enable next button if at least one is checked
                    const card = this.closest('.question-card');
                    if (card) {
                        const checkboxes = card.querySelectorAll('input[type="checkbox"]:checked');
                        const nextBtn = card.querySelector('.btn-primary');
                        if (nextBtn) nextBtn.disabled = checkboxes.length === 0;
                    }
                    
                    // Store data
                    const name = this.name;
                    const value = this.value;
                    if (name && value) {
                        if (!formData[name]) formData[name] = [];
                        
                        if (this.checked) {
                            if (!formData[name].includes(value)) {
                                formData[name].push(value);
                            }
                        } else {
                            formData[name] = formData[name].filter(v => v !== value);
                        }
                    }
                });
            });

            // Add input handlers for number inputs
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.addEventListener('change', function() {
                    formData[this.id] = parseInt(this.value) || 0;
                });
            });

            // Update progress bar
            updateProgress();
        });

        function updateProgress() {
            const progress = ((currentScreen - 1) / 8) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function updateStepIndicator() {
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                
                if (stepNum === currentScreen) {
                    step.classList.add('active');
                } else if (stepNum < currentScreen) {
                    step.classList.add('completed');
                }
            });
        }

        function goToScreen(screenNum) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show target screen
            document.getElementById('screen' + screenNum).classList.add('active');
            
            currentScreen = screenNum;
            updateStepIndicator();
            updateProgress();
            
            // Special handling for specific screens
            if (screenNum === 3) {
                startPatternMatching();
            } else if (screenNum === 4) {
                populateQualityObjectives();
            } else if (screenNum === 5) {
                populateRisks();
            } else if (screenNum === 6) {
                populateResponses();
            } else if (screenNum === 7) {
                startProfessionalReview();
            } else if (screenNum === 8) {
                populateFinalPackage();
            }
            
            // Smooth scroll to top
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        function nextScreen() {
            if (currentScreen < 8) {
                goToScreen(currentScreen + 1);
            }
        }

        function previousScreen() {
            if (currentScreen > 1) {
                goToScreen(currentScreen - 1);
            }
        }

        function nextQuestion() {
            const currentCard = document.querySelector(`.question-card[data-question="${currentQuestion}"]`);
            currentCard.style.display = 'none';
            
            currentQuestion++;
            const nextCard = document.querySelector(`.question-card[data-question="${currentQuestion}"]`);
            if (nextCard) {
                nextCard.style.display = 'block';
            }
        }

        function previousQuestion() {
            const currentCard = document.querySelector(`.question-card[data-question="${currentQuestion}"]`);
            currentCard.style.display = 'none';
            
            currentQuestion--;
            const prevCard = document.querySelector(`.question-card[data-question="${currentQuestion}"]`);
            if (prevCard) {
                prevCard.style.display = 'block';
            }
        }

        function completeQuestions() {
            // Set default values for demo if not selected
            if (!formData.firmType) formData.firmType = 'partnership';
            if (!formData.services.length) formData.services = ['audit', 'review'];
            if (!formData.clientTypes.length) formData.clientTypes = ['private'];
            if (!formData.technology) formData.technology = 'professional';
            if (!formData.externalProviders) formData.externalProviders = 'it-vendor';
            
            nextScreen();
        }

        function startPatternMatching() {
            const steps = ['step1', 'step2', 'step3', 'step4'];
            let currentStep = 0;
            
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    const icon = document.querySelector(`#${steps[currentStep]} .loading-step-icon`);
                    icon.innerHTML = '‚úì';
                    currentStep++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        nextScreen();
                    }, 1000);
                }
            }, 800);
        }

        function startProfessionalReview() {
            setTimeout(() => {
                nextScreen();
            }, 3000);
        }

        function populateQualityObjectives() {
            const objectivesList = document.getElementById('objectivesList');
            objectivesList.innerHTML = '';
            
            qualityObjectives.forEach((objective, index) => {
                const div = document.createElement('div');
                div.className = 'quality-objective';
                div.innerHTML = `
                    <div class="objective-number">${index + 1}</div>
                    <div>
                        <strong>${objective.title}</strong>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            ${objective.description}
                        </p>
                    </div>
                `;
                objectivesList.appendChild(div);
            });

            // Update pattern title
            const pattern = determinePattern();
            document.getElementById('patternTitle').textContent = `Pattern Match: ${pattern}`;
        }

        function populateRisks() {
            const pattern = determinePattern();
            const risks = riskPatterns[pattern] || [];
            selectedRisks = [...risks]; // Store selected risks
            
            const risksList = document.getElementById('risksList');
            risksList.innerHTML = '';
            
            // Group risks by priority
            const highRisks = risks.filter(r => r.level === 'high');
            const mediumRisks = risks.filter(r => r.level === 'medium');
            const lowRisks = risks.filter(r => r.level === 'low');
            
            if (highRisks.length > 0) {
                const highHeader = document.createElement('h3');
                highHeader.style.marginBottom = '20px';
                highHeader.style.color = 'var(--danger-color)';
                highHeader.textContent = 'HIGH PRIORITY';
                risksList.appendChild(highHeader);
                
                highRisks.forEach(risk => {
                    risksList.appendChild(createRiskCard(risk));
                });
            }
            
            if (mediumRisks.length > 0) {
                const mediumHeader = document.createElement('h3');
                mediumHeader.style.margin = '30px 0 20px';
                mediumHeader.style.color = 'var(--warning-color)';
                mediumHeader.textContent = 'MEDIUM PRIORITY';
                risksList.appendChild(mediumHeader);
                
                mediumRisks.forEach(risk => {
                    risksList.appendChild(createRiskCard(risk));
                });
            }
            
            if (lowRisks.length > 0) {
                const lowHeader = document.createElement('h3');
                lowHeader.style.margin = '30px 0 20px';
                lowHeader.style.color = 'var(--success-color)';
                lowHeader.textContent = 'LOW PRIORITY';
                risksList.appendChild(lowHeader);
                
                lowRisks.forEach(risk => {
                    risksList.appendChild(createRiskCard(risk));
                });
            }
        }

        function createRiskCard(risk) {
            const div = document.createElement('div');
            div.className = `risk-card ${risk.level}`;
            div.innerHTML = `
                <div class="risk-header">
                    <div class="risk-title">
                        <span>‚ö†Ô∏è</span>
                        <span>${risk.title}</span>
                    </div>
                    <span class="risk-level ${risk.level}">${risk.level.toUpperCase()}</span>
                </div>
                <div class="risk-details">
                    <p><strong>Why this matters for your firm:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        ${risk.reasons.map(reason => `<li>${reason}</li>`).join('')}
                    </ul>
                    <p style="margin-top: 10px;"><strong>AICPA Requirement:</strong> ${risk.aicpaReference}</p>
                </div>
                <div class="risk-actions">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" class="checkbox-large" checked data-risk-id="${risk.id}">
                        <span>Keep this risk</span>
                    </label>
                </div>
            `;
            return div;
        }

        function populateResponses() {
            const responsesList = document.getElementById('responsesList');
            responsesList.innerHTML = '';
            
            // Get responses for selected risks
            selectedResponses = [];
            selectedRisks.forEach(risk => {
                if (responseMappings[risk.id]) {
                    selectedResponses.push(responseMappings[risk.id]);
                }
            });
            
            selectedResponses.forEach(response => {
                responsesList.appendChild(createResponseCard(response));
            });
        }

        function createResponseCard(response) {
            const div = document.createElement('div');
            div.className = 'response-card';
            div.innerHTML = `
                <div class="response-header">
                    <span class="response-icon">${response.icon}</span>
                    <h3 class="response-title">${response.title}</h3>
                </div>
                <p style="color: var(--text-secondary); margin-bottom: 15px;">
                    ${response.description}
                </p>
                <div class="response-details">
                    <strong>Recommended Procedures:</strong>
                    <ul style="margin-top: 10px; margin-left: 20px;">
                        ${response.procedures.map(proc => `<li>${proc}</li>`).join('')}
                    </ul>
                </div>
                <div class="response-meta">
                    <div class="response-meta-item">
                        <span>‚úÖ</span>
                        <span>Templates: ${response.templates.join(', ')}</span>
                    </div>
                    <div class="response-meta-item">
                        <span>üïê</span>
                        <span>Training: ${response.training}</span>
                    </div>
                    <div class="response-meta-item">
                        <span>üìÖ</span>
                        <span>Implementation: ${response.implementation}</span>
                    </div>
                </div>
                <div class="risk-actions" style="margin-top: 20px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" class="checkbox-large" checked data-response-id="${response.id}">
                        <span>Include this response</span>
                    </label>
                </div>
            `;
            return div;
        }

        function populateFinalPackage() {
            // Update counts
            document.getElementById('riskCount').textContent = selectedRisks.length;
            document.getElementById('responseCount').textContent = selectedResponses.length;
            
            // Update firm name
            const firmName = formData.firmType === 'partnership' ? 'Smith & Associates' : 
                           formData.firmType === 'sole' ? 'Your Practice' : 'Your Firm';
            document.getElementById('firmNameDisplay').textContent = firmName;
        }

        function downloadDocuments() {
            // Simulate download
            alert(`Downloading SQMS Package for ${document.getElementById('firmNameDisplay').textContent}...\n\nIn a real implementation, this would download a ZIP file containing:\n‚Ä¢ Quality Management Manual\n‚Ä¢ All procedures and templates\n‚Ä¢ Implementation guides\n‚Ä¢ Compliance reports`);
        }

        function viewImplementationGuide() {
            // Simulate opening guide
            alert('Opening Implementation Guide...\n\nWeek 1-2: Setup procedures and assign roles\nWeek 3-4: Train staff on new procedures\nWeek 5-6: Implement monitoring systems\nWeek 7-8: Full system operational and first review cycle');
        }

        // Document item click handlers
        document.addEventListener('click', function(e) {
            if (e.target.closest('.document-item')) {
                const docName = e.target.closest('.document-item').querySelector('span:last-child').textContent;
                alert(`Opening ${docName}...\n\nThis would display the full document in a new window or download it.`);
            }
        });

        // Risk and response checkbox handlers
        document.addEventListener('change', function(e) {
            if (e.target.type === 'checkbox' && e.target.classList.contains('checkbox-large')) {
                const card = e.target.closest('.risk-card, .response-card');
                if (card) {
                    if (e.target.checked) {
                        card.style.opacity = '1';
                    } else {
                        card.style.opacity = '0.5';
                    }
                }
                
                // Update selected risks/responses
                if (e.target.dataset.riskId) {
                    const riskId = e.target.dataset.riskId;
                    if (e.target.checked) {
                        if (!selectedRisks.find(r => r.id === riskId)) {
                            const pattern = determinePattern();
                            const risk = riskPatterns[pattern].find(r => r.id === riskId);
                            if (risk) selectedRisks.push(risk);
                        }
                    } else {
                        selectedRisks = selectedRisks.filter(r => r.id !== riskId);
                    }
                }
                
                if (e.target.dataset.responseId) {
                    const responseId = e.target.dataset.responseId;
                    if (e.target.checked) {
                        if (!selectedResponses.find(r => r.id === responseId)) {
                            const response = Object.values(responseMappings).find(r => r.id === responseId);
                            if (response) selectedResponses.push(response);
                        }
                    } else {
                        selectedResponses = selectedResponses.filter(r => r.id !== responseId);
                    }
                }
            }
        });

        // Pattern matching logic
        function determinePattern() {
            const partners = formData.partners || 1;
            const staff = formData.staff || 0;
            const totalSize = partners + staff;
            
            if (totalSize <= 3 || formData.firmType === 'sole') {
                return 'Small Firm';
            } else if (totalSize <= 15) {
                return 'Medium Partnership';
            } else {
                return 'Large Firm';
            }
        }

        // Update firm name display
        function updateFirmName() {
            const firmName = formData.firmType === 'partnership' ? 'Smith & Associates' : 
                           formData.firmType === 'sole' ? 'Your Practice' : 'Your Firm';
            document.querySelectorAll('.firm-name, #firmNameDisplay').forEach(el => {
                el.textContent = firmName;
            });
        }
    </script>
</body>
</html>
